var sowb=window.sowb||{};jQuery((function(i){sowb.setupCarousel=function(){i.fn.setSlideTo=function(e){$item=i(this);var s=$item.slick("slickGetOption","slidesToShow"),o=$item.slick("slickGetOption","slidesToScroll");$item.slick("slickSetOption","slidesToShow",1),$item.slick("slickSetOption","slidesToScroll",1),$item.slick("slickGoTo",e),$item.slick("slickSetOption","slidesToShow",s),$item.slick("slickSetOption","slidesToScroll",o)},i(".sow-carousel-wrapper").each((function(){var e=i(this),s=e.find(".sow-carousel-items");s.not(".slick-initialized").slick({arrows:!1,infinite:!1,rows:0,rtl:"rtl"==e.data("dir"),touchThreshold:20,variableWidth:!0,accessibility:!1,responsive:[{breakpoint:carouselBreakpoints.tablet_portrait,settings:{slidesToScroll:2,slidesToShow:2}},{breakpoint:carouselBreakpoints.mobile,settings:{slidesToScroll:1,slidesToShow:1}}]}),s.on("swipe",(function(i,s,o){e.parent().parent().find(".sow-carousel-"+("left"==o?"next":"prev")).trigger("touchend")})),e.parent().parent().find(".sow-carousel-previous, .sow-carousel-next").on("click touchend",(function(s,o){s.preventDefault();var t=e.find(".sow-carousel-items"),l=t.find(".sow-carousel-item").length,a=l===e.data("post-count"),n=Math.ceil(t.outerWidth()/t.find(".sow-carousel-item").outerWidth(!0)),c=l-n+1;if(!a&&t.slick("slickCurrentSlide")+n>=l-1&&!e.data("fetching")){e.data("fetching",!0);var r=e.data("page")+1;t.slick("slickAdd",'<div class="sow-carousel-item sow-carousel-loading"></div>'),i.get(e.data("ajax-url"),{action:"sow_carousel_load",paged:r,instance_hash:e.parent().parent().find('input[name="instance_hash"]').val()},(function(i,s){t.find(".sow-carousel-loading").remove(),t.slick("slickAdd",i.html),l=e.find(".sow-carousel-item").length,e.data("fetching",!1),e.data("page",r),o&&t.find('.sow-carousel-item[tabindex="0"]').trigger("focus")}))}i(this).hasClass("sow-carousel-next")?a&&t.slick("slickCurrentSlide")>=c?e.data("loop-posts-enabled")&&t.slick("slickGoTo",0):a&&t.slick("slickCurrentSlide")+n>=c?t.setSlideTo(c):t.slick("slickNext"):i(this).hasClass("sow-carousel-previous")&&(e.data("loop-posts-enabled")&&0==t.slick("slickCurrentSlide")?t.slick("slickGoTo",c):t.slick("slickPrev"))}))})),i(document).on("keydown",".sow-carousel-navigation a",(function(e){13!=e.keyCode&&32!=e.keyCode||(e.preventDefault(),i(this).click())})),i(document).on("keyup",".sow-carousel-item",(function(e){if(37==e.keyCode||39==e.keyCode){var s=i(this).parents(".sow-carousel-wrapper"),o=s.find(".sow-carousel-items"),t=o.find(".sow-carousel-item").length,l=i(this).data("slick-index"),a=t-(t===s.data("post-count")?0:1);if(37==e.keyCode)--l<0&&(l=a);else if(39==e.keyCode&&++l>=a){if(s.data("fetching"))return;s.parent().find(".sow-carousel-next").trigger("click",!0)}o.slick("slickGoTo",l,!0),s.find(".sow-carousel-item").prop("tabindex",-1),s.find('.sow-carousel-item[data-slick-index="'+l+'"]').trigger("focus").prop("tabindex",0)}})),i(window).on("resize load",(function(){i(".sow-carousel-wrapper").each((function(){var e=i(this),s=e.find(".sow-carousel-items"),o=Math.ceil(s.outerWidth()/s.find(".sow-carousel-item").outerWidth(!0)),t=e.parent().parent().find(".sow-carousel-navigation");o>=e.data("post-count")?(t.hide(),s.slick("slickSetOption","touchMove",!1),s.slick("slickSetOption","draggable",!1)):t.not(":visible")&&(t.show(),s.slick("slickSetOption","touchMove",!0),s.slick("slickSetOption","draggable",!0))})),window.matchMedia("(min-width: "+carouselBreakpoints.tablet_portrait+"px) and (max-width: "+carouselBreakpoints.tablet_landscape+"px) and (orientation: landscape)").matches&&(i(".sow-carousel-items").slick("slickSetOption","slidesToShow",3),i(".sow-carousel-items").slick("slickSetOption","slidesToScroll",3)),i(".sow-carousel-item:first-of-type").prop("tabindex",0)}))},sowb.setupCarousel(),i(sowb).on("setup_widgets",sowb.setupCarousel)})),window.sowb=sowb;